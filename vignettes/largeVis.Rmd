---
title: "largeVis"
author: "Amos Elberg"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    fig_caption: yes
  rmarkdown::pdf_document:
    fig_caption: yes
vignette: >
  %\VignetteIndexEntry{LargeVis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup,eval=T,echo=F,warning=F,error=F,message=F}
# Note to reader:  Please don't steal the semi-distinctive visual style I spent several hours creating for myself.
library(RColorBrewer,quietly=T)
library(wesanderson,quietly=T)
colors_discrete <- function(x) wes_palette("Darjeeling", n = x)
colors_divergent_discrete <- function(x) grDevices::colorRampPalette(RColorBrewer::brewer.pal(x, "Spectral"))
colors_continuous <-  function(x) wes_palette(name= "Zissou",n = x, type= "continuous")
nacol <- colors_discrete(4)[4]
require(ggplot2,quietly = T)
theme_set(
  theme_bw() %+replace%
  theme(
    legend.key.size=unit(4,"mm"), 
    legend.title=element_text(size=rel(0.8), face = "bold"),
    legend.margin=unit(0,"cm"),
    legend.position="bottom",
    legend.key.size=unit(0.5,"lines"),
    legend.text=element_text(size = unit(10, "points")), 
    axis.title.y = element_text(angle=90),
    axis.text = element_text(size=rel(0.7)),
    plot.margin = unit(c(0, 0.5, 1, 0), "lines"), 
    axis.title=element_text(size=rel(0.8),face="bold"),
  title = element_text(size=rel(0.9))
                          ) 
)

```
This Vingette provides an overview of the largeVis package.  

### Manifold Embeddings
Manifold embeddings attempt to find a low-dimensional (i.e., 2-D) representation of high-dimensional data that preserves the relationships among examples in the dataset. Examples that are similar to each other in high-dimensional space should appear close to each other in the low-dimensional space. 

LargeVis is intended to overcome a significant limitation of prior methods, that they are impractical for large datasets because they run in $O(n^2)$ or, at best, $O(n \log n)$. LargeVis should run in $O(n)$.

The neighboring nodes are used to estimate a probility distribution of each node's neighbors. 

Then, a lower dimensional embedding is estimated, first by random initialization.  Each node is assigned a position chosen at radnom. The embeddings are then updated to move similar nodes close together (and distant nodes further apart), according to a probabilstic functon that realates their distance in the low-dimensional space to the probability that the nodes are neighbors in the high-dimensional space. 

### Observations

t-SNE embedding has proven effecitve in wide variety of data contexts. 

However, the t-SNE algorithm depends on the identifying each node's nearest neighbors, an $O(N^2)$ operation at best. 

## Vignette Info
```{r}

```

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Effect of Hyperparameters

The following grid illustrates the effect of the $\alpha$ and $\gamma$ hyperparameters on the `wiki` dataset:

```{r wikihyperparameters,echo=F,cache=TRUE,fig.width=6,fig.height=8}
require(largeVis)
require(ggplot2)
data(wiki)
coords <- data.frame(x = numeric(0), 
                     y = numeric(0), 
                     a = numeric(0), 
                     g = numeric(0))
for (g in c(.5,1,7,14)) {
  for (a in c(.1,1,2,5,10)) {
    localcoords <- projectKNNs(wiki, alpha =  a, gamma = g,verbose=FALSE)
    localcoords <- data.frame(scale(localcoords))
    colnames(localcoords) <- c("x", "y")
    localcoords$a <- a
    localcoords$g <- g
    localcoords$activity <- Matrix::colSums(wiki)
    coords <- rbind(coords, localcoords)
  }
}
ggplot(coords, 
       aes(x = x, y = y, fill = log(activity))) + 
  geom_point(alpha = 0.2, size = 0.05) +
  facet_grid(a ~ g, 
             labeller = label_bquote(alpha == .(a), gamma == .(g))
             , scales = 'free') +
  scale_x_continuous(breaks=NULL,name="") + 
  scale_y_continuous(breaks=NULL,name = "") +
  ggtitle(expression(paste("Effect of", alpha, "vs.", gamma, sep = "  ")))
```
```{r}
save(coords, file="alphagammacoords.Rda")
```

($\alpha = 0$ uses a different probability distribution for the distances, $p(e_{ij} = 1) = f(1 / (1 + \exp(||\vec{y_1} - \vec{y_2}||^2)))$).

## Performance of Nearest Neighbor Sear

## Figures




The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
